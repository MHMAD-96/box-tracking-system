<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Box Tracker">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQm94IFRyYWNrZXIiLCJzaG9ydF9uYW1lIjoiQm94VHJhY2tlciIsImRlc2NyaXB0aW9uIjoi2YbYudin2YUg2KrYqtio2Lkg2LXZhtin2YrYr9mKIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmZmZmZmYiLCJ0aGVtZV9jb2xvciI6IiM2NjdlZWEiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRJNElpQm9aV2xuYUhROUlqRXlPQ0lpSUhabGNuTnBiMjQ5SWpFdU1TQXhJREF0TkMweUxqVWdNaTR6SWlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpUGdvZ0lDQThjbVZqZENCNFBTSXhOaUlnZVQwaU1UWWlJSGRwWkhSb1BTSTVOaUlnYUdWcFoyaDBQU0k1TmlJZ1pubHNiRDBpSXprNU1pSTRNakVpSUhKNFBTSTRJaTgrQ2lBZ0lEeDBaWGgwSUhnOUlqWTBJaUI1UFNJek1pSWdabWxzYkQwaUluWm1abVppSWlCbWIyNTBMWE5wZW1VOUlqSXpJaUIwWlhoMExXRnVZMmh2Y2owaWJXbGtaR3hsSWo0NFEwczRRaUF6ZURFd1BDOTBaWGgwUGdvOEwzTjJaejQ9IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwiLCJzaXplcyI6IjEyOHgxMjgifV19">
    <title>Box Tracker - Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --text-color: #333;
            --bg-color: #f8f9fa;
            --card-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        body {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            padding: 10px;
            transition: all 0.3s ease;
        }
        
        body.en {
            direction: ltr;
            text-align: left;
        }
        
        body.en * {
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            position: relative;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            color: var(--text-color);
            position: relative;
        }
        
        .language-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .language-toggle:hover {
            background: var(--secondary-color);
        }
        
        .install-button {
            position: absolute;
            top: 0;
            left: 0;
            background: var(--success-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            display: none;
        }
        
        .header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 24px;
        }
        
        .user-role {
            background: var(--warning-color);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            display: inline-block;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }
        
        .tab-button {
            flex: 1;
            padding: 12px 8px;
            background: var(--bg-color);
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            min-width: 100px;
        }
        
        .tab-button.active {
            background: var(--primary-color);
            color: white;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--text-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn.success { background: var(--success-color); }
        .btn.danger { background: var(--danger-color); }
        .btn.warning { background: var(--warning-color); }
        
        .photo-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .photo-input input[type="file"] {
            flex: 1;
        }
        
        .photo-preview {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .summary-card {
            background: var(--bg-color);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-right: 4px solid var(--primary-color);
        }
        
        .summary-card.rtl {
            border-right: none;
            border-left: 4px solid var(--primary-color);
        }
        
        .driver-stats {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .driver-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--text-color);
            margin-bottom: 10px;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        .stat-row:last-child {
            border-bottom: none;
        }
        
        .loss-percentage {
            font-weight: bold;
        }
        
        .loss-low { color: var(--success-color); }
        .loss-medium { color: var(--warning-color); }
        .loss-high { color: var(--danger-color); }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }
        
        .alert.success {
            background: #d4edda;
            color: #155724;
        }
        
        .alert.danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        .alert.warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .login-form {
            max-width: 300px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: var(--card-shadow);
        }
        
        .whatsapp-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #25D366;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @media (max-width: 600px) {
            .container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-button {
                flex: none;
            }
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- WhatsApp Alert -->
    <div id="whatsappAlert" class="whatsapp-alert">
        <div id="whatsappText"></div>
    </div>

    <!-- Login Form -->
    <div id="loginForm" class="login-form">
        <h2 data-ar="Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…" data-en="System Login">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
        <div class="form-group">
            <label data-ar="Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" data-en="User Type">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
            <select id="userType">
                <option value="driver" data-ar="Ø³Ø§Ø¦Ù‚" data-en="Driver">Ø³Ø§Ø¦Ù‚</option>
                <option value="manager" data-ar="Ù…Ø¯ÙŠØ±" data-en="Manager">Ù…Ø¯ÙŠØ±</option>
            </select>
        </div>
        <div class="form-group" id="driverSelectGroup">
            <label data-ar="Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ" data-en="Select Your Name">Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ</label>
            <select id="loginDriverSelect">
                <option value="" data-ar="Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚" data-en="Select Driver">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚</option>
            </select>
        </div>
        <div class="form-group hidden" id="passwordGroup">
            <label data-ar="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" data-en="Password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <input type="password" id="managerPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        </div>
        <button class="btn" onclick="login()" data-ar="Ø¯Ø®ÙˆÙ„" data-en="Login">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="container hidden">
        <div class="header">
            <button class="language-toggle" onclick="toggleLanguage()" id="langToggle">EN</button>
            <button class="install-button" onclick="installApp()" id="installBtn" data-ar="ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚" data-en="Install App">ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
            <h1 data-ar="ğŸšš Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚" data-en="ğŸšš Box Tracking System">ğŸšš Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</h1>
            <p data-ar="Ù…Ø®Ø¨Ø² Ø§Ù„ØªÙˆØ²ÙŠØ¹ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚" data-en="Distribution Bakery - Box Management">Ù…Ø®Ø¨Ø² Ø§Ù„ØªÙˆØ²ÙŠØ¹ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚</p>
            <div class="user-role" id="userRole"></div>
            <button class="btn danger" onclick="logout()" style="width: auto; padding: 8px 20px; margin-top: 10px;" data-ar="Ø®Ø±ÙˆØ¬" data-en="Logout">Ø®Ø±ÙˆØ¬</button>
        </div>
        
        <div class="tabs" id="mainTabs">
            <button class="tab-button active" onclick="showTab('delivery')" data-ar="ØªØ³Ù„ÙŠÙ… ØµÙ†Ø§Ø¯ÙŠÙ‚" data-en="Delivery">ØªØ³Ù„ÙŠÙ… ØµÙ†Ø§Ø¯ÙŠÙ‚</button>
            <button class="tab-button" onclick="showTab('return')" data-ar="Ø§Ø³ØªÙ„Ø§Ù… ØµÙ†Ø§Ø¯ÙŠÙ‚" data-en="Return">Ø§Ø³ØªÙ„Ø§Ù… ØµÙ†Ø§Ø¯ÙŠÙ‚</button>
            <button class="tab-button" onclick="showTab('reports')" data-ar="Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±" data-en="Reports">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
            <button class="tab-button hidden" id="managerTab" onclick="showTab('manager')" data-ar="Ø¥Ø¯Ø§Ø±Ø©" data-en="Management">Ø¥Ø¯Ø§Ø±Ø©</button>
        </div>
        
        <!-- Delivery Tab -->
        <div id="delivery" class="tab-content active">
            <h2 data-ar="ğŸ“¦ ØªØ³Ù„ÙŠÙ… ØµÙ†Ø§Ø¯ÙŠÙ‚" data-en="ğŸ“¦ Box Delivery">ğŸ“¦ ØªØ³Ù„ÙŠÙ… ØµÙ†Ø§Ø¯ÙŠÙ‚</h2>
            <div class="form-group" id="deliveryDriverGroup">
                <label data-ar="Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚:" data-en="Driver Name:">Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚:</label>
                <select id="driverSelect">
                    <option value="" data-ar="Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚" data-en="Select Driver">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚</option>
                </select>
            </div>
            <div class="form-group">
                <label data-ar="Ø¹Ø¯Ø¯ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ø³Ù„Ù…Ø©:" data-en="Number of Boxes Delivered:">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ø³Ù„Ù…Ø©:</label>
                <input type="number" id="deliveredBoxes" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚" min="1">
            </div>
            <div class="form-group">
                <label data-ar="ØµÙˆØ±Ø© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ…:" data-en="Photo Before Delivery:">ØµÙˆØ±Ø© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ù‚Ø¨Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ…:</label>
                <div class="photo-input">
                    <input type="file" id="deliveryPhoto" accept="image/*" capture="camera">
                    <button type="button" onclick="document.getElementById('deliveryPhoto').click()" class="btn" style="width: auto; padding: 10px;">ğŸ“·</button>
                </div>
                <img id="deliveryPreview" class="photo-preview hidden" alt="Preview">
            </div>
            <div class="form-group">
                <label data-ar="Ù…Ù„Ø§Ø­Ø¸Ø§Øª:" data-en="Notes:">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                <textarea id="deliveryNotes" placeholder="Ø£Ø¶Ù Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª..." rows="3"></textarea>
            </div>
            <button class="btn" onclick="recordDelivery()" data-ar="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ³Ù„ÙŠÙ…" data-en="Record Delivery">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>
            <div id="deliveryMessage"></div>
        </div>
        
        <!-- Return Tab -->
        <div id="return" class="tab-content">
            <h2 data-ar="ğŸ“¥ Ø§Ø³ØªÙ„Ø§Ù… ØµÙ†Ø§Ø¯ÙŠÙ‚" data-en="ğŸ“¥ Box Return">ğŸ“¥ Ø§Ø³ØªÙ„Ø§Ù… ØµÙ†Ø§Ø¯ÙŠÙ‚</h2>
            <div class="form-group" id="returnDriverGroup">
                <label data-ar="Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚:" data-en="Driver Name:">Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚:</label>
                <select id="returnDriverSelect">
                    <option value="" data-ar="Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚" data-en="Select Driver">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚</option>
                </select>
            </div>
            <div class="form-group">
                <label data-ar="Ø¹Ø¯Ø¯ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:" data-en="Number of Boxes Returned:">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:</label>
                <input type="number" id="returnedBoxes" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚" min="0">
            </div>
            <div class="form-group">
                <label data-ar="ØµÙˆØ±Ø© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©:" data-en="Photo of Returned Boxes:">ØµÙˆØ±Ø© Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ±Ø¬Ø¹Ø©:</label>
                <div class="photo-input">
                    <input type="file" id="returnPhoto" accept="image/*" capture="camera">
                    <button type="button" onclick="document.getElementById('returnPhoto').click()" class="btn" style="width: auto; padding: 10px;">ğŸ“·</button>
                </div>
                <img id="returnPreview" class="photo-preview hidden" alt="Preview">
            </div>
            <div class="form-group">
                <label data-ar="Ù…Ù„Ø§Ø­Ø¸Ø§Øª:" data-en="Notes:">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                <textarea id="returnNotes" placeholder="Ø£Ø¶Ù Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª..." rows="3"></textarea>
            </div>
            <button class="btn" onclick="recordReturn()" data-ar="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…" data-en="Record Return">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</button>
            <div id="returnMessage"></div>
        </div>
        
        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2 data-ar="ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡" data-en="ğŸ“Š Performance Reports">ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø¯Ø§Ø¡</h2>
            
            <div class="summary-card">
                <h3 data-ar="Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©" data-en="General Statistics">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
                <div class="stat-row">
                    <span data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ø³Ù„Ù…Ø©:" data-en="Total Delivered:">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ø³Ù„Ù…Ø©:</span>
                    <span id="totalDelivered">0</span>
                </div>
                <div class="stat-row">
                    <span data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:" data-en="Total Returned:">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©:</span>
                    <span id="totalReturned">0</span>
                </div>
                <div class="stat-row">
                    <span data-ar="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯:" data-en="Total Lost:">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯:</span>
                    <span id="totalLost">0</span>
                </div>
                <div class="stat-row">
                    <span data-ar="Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø¯Ø±:" data-en="Loss Percentage:">Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø¯Ø±:</span>
                    <span class="loss-percentage" id="lossPercentage">0%</span>
                </div>
                <div class="stat-row">
                    <span data-ar="Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù‡Ø¯Ø±:" data-en="Financial Loss:">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù‡Ø¯Ø±:</span>
                    <span id="lossCost" data-ar-suffix=" Ø¯Ø±Ù‡Ù…" data-en-suffix=" AED">0 Ø¯Ø±Ù‡Ù…</span>
                </div>
            </div>
            
            <h3 data-ar="Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†" data-en="Driver Performance">Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</h3>
            <div id="driverStats"></div>
        </div>
        
        <!-- Manager Tab -->
        <div id="manager" class="tab-content">
            <h2 data-ar="âš™ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±" data-en="âš™ï¸ Manager Dashboard">âš™ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
            
            <div class="form-group">
                <label data-ar="Ø±Ù‚Ù… Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:" data-en="WhatsApp Group Number:">Ø±Ù‚Ù… Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:</label>
                <input type="text" id="whatsappGroup" placeholder="+971xxxxxxxxx" value="+971501234567">
            </div>
            
            <div class="form-group">
                <label data-ar="Ø­Ø¯ ØªÙ†Ø¨ÙŠÙ‡ Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø¯Ø± (%):" data-en="Loss Alert Threshold (%):">Ø­Ø¯ ØªÙ†Ø¨ÙŠÙ‡ Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø¯Ø± (%):</label>
                <input type="number" id="alertThreshold" value="20" min="1" max="100">
            </div>
            
            <button class="btn warning" onclick="sendTestAlert()" data-ar="Ø§Ø®ØªØ¨Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡ ÙˆØ§ØªØ³Ø§Ø¨" data-en="Test WhatsApp Alert">Ø§Ø®ØªØ¨Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡ ÙˆØ§ØªØ³Ø§Ø¨</button>
            <button class="btn" onclick="exportData()" data-ar="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" data-en="Export Data">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button class="btn danger" onclick="clearAllData()" data-ar="Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" data-en="Clear All Data">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            
            <div class="summary-card">
                <h3 data-ar="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…" data-en="System Settings">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                <div class="stat-row">
                    <span data-ar="Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†:" data-en="Number of Drivers:">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†:</span>
                    <span id="driverCount">13</span>
                </div>
                <div class="stat-row">
                    <span data-ar="Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:" data-en="Last Update:">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</span>
                    <span id="lastUpdate">-</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ØªÙƒÙˆÙŠÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        const CONFIG = {
            drivers: [
                'RAMIS', 'RAMSHAD', 'MADHU', 'SIDHIQ', 'ASIF', 'IRFAN', 'MIBIN', 
                'MOHAMMED', 'PRADEESH', 'BASAHR', 'NABIL', 'ARIF', 'KHATEEB'
            ],
            managerPassword: 'admin123',
            alertThreshold: 20,
            boxCost: 20,
            whatsappGroup: '+971501234567'
        };
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        let currentUser = null;
        let currentRole = null;
        let currentLanguage = 'ar';
        let deferredPrompt;
        
        // Ø§Ù„Ù†ØµÙˆØµ Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ù„ØºØ§Øª
        const translations = {
            ar: {
                'System Login': 'Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…',
                'User Type': 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…',
                'Driver': 'Ø³Ø§Ø¦Ù‚',
                'Manager': 'Ù…Ø¯ÙŠØ±',
                'Select Your Name': 'Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ',
                'Select Driver': 'Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚',
                'Password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
                'Login': 'Ø¯Ø®ÙˆÙ„',
                'Logout': 'Ø®Ø±ÙˆØ¬'
            },
            en: {
                'Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…': 'System Login',
                'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…': 'User Type',
                'Ø³Ø§Ø¦Ù‚': 'Driver',
                'Ù…Ø¯ÙŠØ±': 'Manager',
                'Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ': 'Select Your Name',
                'Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚': 'Select Driver',
                'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±': 'Password',
                'Ø¯Ø®ÙˆÙ„': 'Login',
                'Ø®Ø±ÙˆØ¬': 'Logout'
            }
        };
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            loadDrivers();
            setupPhotoPreview();
            setupPWA();
            updateLanguage();
            checkAutoLogin();
        });
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ PWA
        function setupPWA() {
            // Ø¥Ø¹Ø¯Ø§Ø¯ service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4ge30pOw==');
            }
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                document.getElementById('installBtn').style.display = 'block';
            });
        }
        
        // ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted installation');
                        document.getElementById('installAppBtn').style.display = 'none';
                    }
                    deferredPrompt = null;
                });
            } else {
                showInstallInstructions();
            }
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„ØªØ«Ø¨ÙŠØª
        function showInstallInstructions() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            let instructions = '';
            
            if (isIOS) {
                instructions = currentLanguage === 'ar' ? 
                    'Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ iPhone/iPad:\n\n1. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© (â†—ï¸)\n2. Ø§Ø®ØªØ± "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"\n3. Ø§Ø¶ØºØ· "Ø¥Ø¶Ø§ÙØ©"' :
                    'To install on iPhone/iPad:\n\n1. Tap the Share button (â†—ï¸)\n2. Select "Add to Home Screen"\n3. Tap "Add"';
            } else if (isAndroid) {
                instructions = currentLanguage === 'ar' ? 
                    'Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Android:\n\n1. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙØ­ (â‹®)\n2. Ø§Ø®ØªØ± "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"\n3. Ø§Ø¶ØºØ· "Ø¥Ø¶Ø§ÙØ©"' :
                    'To install on Android:\n\n1. Tap browser menu (â‹®)\n2. Select "Add to Home Screen"\n3. Tap "Add"';
            } else {
                instructions = currentLanguage === 'ar' ? 
                    'ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙƒÙ…Ø±Ø¬Ø¹ÙŠØ© ÙÙŠ Ù…ØªØµÙØ­Ùƒ Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹' :
                    'You can bookmark this app in your browser for quick access';
            }
            
            alert(instructions);
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†
        function loadDrivers() {
            const selects = ['driverSelect', 'returnDriverSelect', 'loginDriverSelect'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    // Ù…Ø³Ø­ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø¹Ø¯Ø§ Ø§Ù„Ø£ÙˆÙ„)
                    while (select.children.length > 1) {
                        select.removeChild(select.lastChild);
                    }
                    
                    CONFIG.drivers.forEach(driver => {
                        const option = new Option(driver, driver);
                        select.add(option);
                    });
                }
            });
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±
        function setupPhotoPreview() {
            const photoInputs = [
                { input: 'deliveryPhoto', preview: 'deliveryPreview' },
                { input: 'returnPhoto', preview: 'returnPreview' }
            ];
            
            photoInputs.forEach(({input, preview}) => {
                const inputElement = document.getElementById(input);
                const previewElement = document.getElementById(preview);
                
                if (inputElement && previewElement) {
                    inputElement.addEventListener('change', function(e) {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                previewElement.src = e.target.result;
                                previewElement.classList.remove('hidden');
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
            });
        }
        
        // ÙØ­Øµ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        function checkAutoLogin() {
            const savedUser = localStorage.getItem('currentUser');
            const savedRole = localStorage.getItem('currentRole');
            
            if (savedUser && savedRole) {
                currentUser = savedUser;
                currentRole = savedRole;
                showMainApp();
            }
        }
        
        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'ar' ? 'en' : 'ar';
            updateLanguage();
            localStorage.setItem('language', currentLanguage);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ØºØ©
        function updateLanguage() {
            const body = document.body;
            const langToggle = document.getElementById('langToggle');
            
            if (currentLanguage === 'en') {
                body.classList.add('en');
                body.style.direction = 'ltr';
                langToggle.textContent = 'Ø¹Ø±Ø¨ÙŠ';
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®ØµØ§Øª
                document.querySelectorAll('.summary-card').forEach(card => {
                    card.classList.add('rtl');
                });
            } else {
                body.classList.remove('en');
                body.style.direction = 'rtl';
                langToggle.textContent = 'EN';
                
                document.querySelectorAll('.summary-card').forEach(card => {
                    card.classList.remove('rtl');
                });
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ
            document.querySelectorAll('[data-ar]').forEach(element => {
                const arText = element.getAttribute('data-ar');
                const enText = element.getAttribute('data-en');
                
                if (currentLanguage === 'ar' && arText) {
                    element.textContent = arText;
                } else if (currentLanguage === 'en' && enText) {
                    element.textContent = enText;
                }
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†ØµÙŠØ© Ø§Ù„Ù…ØªØºÙŠØ±Ø©
            updateReports();
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function login() {
            const userType = document.getElementById('userType').value;
            const driver = document.getElementById('loginDriverSelect').value;
            const password = document.getElementById('managerPassword').value;
            
            if (userType === 'driver') {
                if (!driver) {
                    showAlert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚', 'Please select driver name', 'danger');
                    return;
                }
                currentUser = driver;
                currentRole = 'driver';
            } else if (userType === 'manager') {
                if (password !== CONFIG.managerPassword) {
                    showAlert('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©', 'Wrong password', 'danger');
                    return;
                }
                currentUser = 'Manager';
                currentRole = 'manager';
            }
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
            localStorage.setItem('currentUser', currentUser);
            localStorage.setItem('currentRole', currentRole);
            
            showMainApp();
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        function showMainApp() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const userRole = document.getElementById('userRole');
            const managerTab = document.getElementById('managerTab');
            const deliveryDriverGroup = document.getElementById('deliveryDriverGroup');
            const returnDriverGroup = document.getElementById('returnDriverGroup');
            
            if (currentRole === 'manager') {
                userRole.textContent = currentLanguage === 'ar' ? 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…' : 'System Manager';
                managerTab.classList.remove('hidden');
            } else {
                userRole.textContent = currentUser;
                managerTab.classList.add('hidden');
                
                // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ù„Ù„Ø³Ø§Ø¦Ù‚ ÙˆØªØ¹ÙŠÙŠÙ† Ø§Ø³Ù…Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                deliveryDriverGroup.style.display = 'none';
                returnDriverGroup.style.display = 'none';
                document.getElementById('driverSelect').value = currentUser;
                document.getElementById('returnDriverSelect').value = currentUser;
            }
            
            updateReports();
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('currentRole');
            currentUser = null;
            currentRole = null;
            
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('loginDriverSelect').value = '';
            document.getElementById('managerPassword').value = '';
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function showTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¹Ù†Ø¯ ÙØªØ­Ù‡Ø§
            if (tabName === 'reports' || tabName === 'manager') {
                updateReports();
            }
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
        function showAlert(arMessage, enMessage, type = 'success') {
            const message = currentLanguage === 'ar' ? arMessage : enMessage;
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type}`;
            alertDiv.textContent = message;
            
            return alertDiv.outerHTML;
        }
        
        // ØªØ³Ø¬ÙŠÙ„ ØªØ³Ù„ÙŠÙ… Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
        function recordDelivery() {
            const driver = document.getElementById('driverSelect').value;
            const boxes = parseInt(document.getElementById('deliveredBoxes').value);
            const photo = document.getElementById('deliveryPhoto').files[0];
            const notes = document.getElementById('deliveryNotes').value;
            const messageDiv = document.getElementById('deliveryMessage');
            
            if (!driver || !boxes || boxes <= 0) {
                messageDiv.innerHTML = showAlert(
                    'ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­',
                    'Please fill all fields correctly',
                    'danger'
                );
                return;
            }
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©
            let photoData = null;
            if (photo) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    photoData = e.target.result;
                    saveDelivery(driver, boxes, photoData, notes, messageDiv);
                };
                reader.readAsDataURL(photo);
            } else {
                saveDelivery(driver, boxes, null, notes, messageDiv);
            }
        }
        
        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ…
        function saveDelivery(driver, boxes, photo, notes, messageDiv) {
            let deliveries = JSON.parse(localStorage.getItem('deliveries') || '[]');
            const delivery = {
                id: Date.now(),
                driver: driver,
                boxes: boxes,
                photo: photo,
                notes: notes,
                date: new Date().toISOString(),
                timestamp: new Date().toLocaleString(currentLanguage === 'ar' ? 'ar-AE' : 'en-US')
            };
            
            deliveries.push(delivery);
            localStorage.setItem('deliveries', JSON.stringify(deliveries));
            
            // Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
            messageDiv.innerHTML = showAlert(
                `âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ ØªØ³Ù„ÙŠÙ… ${boxes} ØµÙ†Ø¯ÙˆÙ‚ Ù„Ù„Ø³Ø§Ø¦Ù‚ ${driver}`,
                `âœ… Recorded delivery of ${boxes} boxes for driver ${driver}`,
                'success'
            );
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('deliveredBoxes').value = '';
            document.getElementById('deliveryPhoto').value = '';
            document.getElementById('deliveryNotes').value = '';
            document.getElementById('deliveryPreview').classList.add('hidden');
            
            // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ù†Ø´Ø§Ø·
            localStorage.setItem('lastUpdate', new Date().toLocaleString());
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚
        function recordReturn() {
            const driver = document.getElementById('returnDriverSelect').value;
            const boxes = parseInt(document.getElementById('returnedBoxes').value);
            const photo = document.getElementById('returnPhoto').files[0];
            const notes = document.getElementById('returnNotes').value;
            const messageDiv = document.getElementById('returnMessage');
            
            if (!driver || boxes < 0) {
                messageDiv.innerHTML = showAlert(
                    'ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­',
                    'Please fill all fields correctly',
                    'danger'
                );
                return;
            }
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©
            let photoData = null;
            if (photo) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    photoData = e.target.result;
                    saveReturn(driver, boxes, photoData, notes, messageDiv);
                };
                reader.readAsDataURL(photo);
            } else {
                saveReturn(driver, boxes, null, notes, messageDiv);
            }
        }
        
        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
        function saveReturn(driver, boxes, photo, notes, messageDiv) {
            let returns = JSON.parse(localStorage.getItem('returns') || '[]');
            const returnData = {
                id: Date.now(),
                driver: driver,
                boxes: boxes,
                photo: photo,
                notes: notes,
                date: new Date().toISOString(),
                timestamp: new Date().toLocaleString(currentLanguage === 'ar' ? 'ar-AE' : 'en-US')
            };
            
            returns.push(returnData);
            localStorage.setItem('returns', JSON.stringify(returns));
            
            // Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
            messageDiv.innerHTML = showAlert(
                `âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ø³ØªÙ„Ø§Ù… ${boxes} ØµÙ†Ø¯ÙˆÙ‚ Ù…Ù† Ø§Ù„Ø³Ø§Ø¦Ù‚ ${driver}`,
                `âœ… Recorded return of ${boxes} boxes from driver ${driver}`,
                'success'
            );
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            document.getElementById('returnedBoxes').value = '';
            document.getElementById('returnPhoto').value = '';
            document.getElementById('returnNotes').value = '';
            document.getElementById('returnPreview').classList.add('hidden');
            
            // ÙØ­Øµ Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø¯Ø± ÙˆØ¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
            checkLossAlert(driver);
            
            // ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ù†Ø´Ø§Ø·
            localStorage.setItem('lastUpdate', new Date().toLocaleString());
        }
        
        // ÙØ­Øµ ØªÙ†Ø¨ÙŠÙ‡ Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø¯Ø±
        function checkLossAlert(driver) {
            const stats = calculateDriverStats(driver);
            const threshold = parseInt(localStorage.getItem('alertThreshold') || '20');
            
            if (stats.lossRate >= threshold) {
                sendWhatsAppAlert(driver, stats);
            }
        }
        
        // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚
        function calculateDriverStats(driverName) {
            const deliveries = JSON.parse(localStorage.getItem('deliveries') || '[]');
            const returns = JSON.parse(localStorage.getItem('returns') || '[]');
            
            const driverDeliveries = deliveries.filter(d => d.driver === driverName);
            const driverReturns = returns.filter(r => r.driver === driverName);
            
            const delivered = driverDeliveries.reduce((sum, d) => sum + d.boxes, 0);
            const returned = driverReturns.reduce((sum, r) => sum + r.boxes, 0);
            const lost = delivered - returned;
            const lossRate = delivered > 0 ? ((lost / delivered) * 100) : 0;
            const cost = lost * CONFIG.boxCost;
            
            return { delivered, returned, lost, lossRate, cost };
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ ÙˆØ§ØªØ³Ø§Ø¨
        function sendWhatsAppAlert(driver, stats) {
            const groupNumber = localStorage.getItem('whatsappGroup') || CONFIG.whatsappGroup;
            const message = currentLanguage === 'ar' ? 
                `ğŸš¨ ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø¯Ø± ØµÙ†Ø§Ø¯ÙŠÙ‚\n\nØ§Ù„Ø³Ø§Ø¦Ù‚: ${driver}\nÙ†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø¯Ø±: ${stats.lossRate.toFixed(1)}%\nØ¹Ø¯Ø¯ Ø§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©: ${stats.lost}\nØ§Ù„ØªÙƒÙ„ÙØ©: ${stats.cost} Ø¯Ø±Ù‡Ù…\n\nÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙÙˆØ±Ø§Ù‹` :
                `ğŸš¨ Box Loss Alert\n\nDriver: ${driver}\nLoss Rate: ${stats.lossRate.toFixed(1)}%\nLost Boxes: ${stats.lost}\nCost: ${stats.cost} AED\n\nPlease follow up immediately`;
            
            const whatsappUrl = `https://wa.me/${groupNumber.replace('+', '')}?text=${encodeURIComponent(message)}`;
            
            // Ø¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
            showWhatsAppAlert(message);
            
            // ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ (ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­)
            if (confirm(currentLanguage === 'ar' ? 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ØŸ' : 'Send alert via WhatsApp?')) {
                window.open(whatsappUrl, '_blank');
            }
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡ ÙˆØ§ØªØ³Ø§Ø¨ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function showWhatsAppAlert(message) {
            const alertDiv = document.getElementById('whatsappAlert');
            const textDiv = document.getElementById('whatsappText');
            
            textDiv.textContent = message;
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
        }
        
        // Ø§Ø®ØªØ¨Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡ ÙˆØ§ØªØ³Ø§Ø¨
        function sendTestAlert() {
            const testMessage = currentLanguage === 'ar' ? 
                'ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª\n\nØ§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ âœ…' :
                'ğŸ§ª Alert System Test\n\nSystem working correctly âœ…';
            
            showWhatsAppAlert(testMessage);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
        function updateReports() {
            const deliveries = JSON.parse(localStorage.getItem('deliveries') || '[]');
            const returns = JSON.parse(localStorage.getItem('returns') || '[]');
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
            const totalDelivered = deliveries.reduce((sum, d) => sum + d.boxes, 0);
            const totalReturned = returns.reduce((sum, r) => sum + r.boxes, 0);
            const totalLost = totalDelivered - totalReturned;
            const lossPercentage = totalDelivered > 0 ? ((totalLost / totalDelivered) * 100).toFixed(1) : 0;
            const lossCost = totalLost * CONFIG.boxCost;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ±
            document.getElementById('totalDelivered').textContent = totalDelivered.toLocaleString();
            document.getElementById('totalReturned').textContent = totalReturned.toLocaleString();
            document.getElementById('totalLost').textContent = totalLost.toLocaleString();
            
            const lossPercentageElement = document.getElementById('lossPercentage');
            lossPercentageElement.textContent = lossPercentage + '%';
            
            // ØªÙ„ÙˆÙŠÙ† Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø¯Ø±
            lossPercentageElement.className = 'loss-percentage ';
            if (parseFloat(lossPercentage) < 10) {
                lossPercentageElement.className += 'loss-low';
            } else if (parseFloat(lossPercentage) < 20) {
                lossPercentageElement.className += 'loss-medium';
            } else {
                lossPercentageElement.className += 'loss-high';
            }
            
            const lossCostElement = document.getElementById('lossCost');
            const costText = lossCost.toLocaleString();
            lossCostElement.textContent = currentLanguage === 'ar' ? costText + ' Ø¯Ø±Ù‡Ù…' : costText + ' AED';
            
            // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†
            updateDriverStats(deliveries, returns);
            
            // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±
            if (currentRole === 'manager') {
                const lastUpdate = localStorage.getItem('lastUpdate');
                const lastUpdateElement = document.getElementById('lastUpdate');
                if (lastUpdateElement) {
                    lastUpdateElement.textContent = lastUpdate || '-';
                }
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†
        function updateDriverStats(deliveries, returns) {
            const driverStatsDiv = document.getElementById('driverStats');
            if (!driverStatsDiv) return;
            
            const driverStats = {};
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ØªØ³Ù„ÙŠÙ…Ø§Øª
            deliveries.forEach(d => {
                if (!driverStats[d.driver]) {
                    driverStats[d.driver] = { delivered: 0, returned: 0 };
                }
                driverStats[d.driver].delivered += d.boxes;
            });
            
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…Ø§Øª
            returns.forEach(r => {
                if (!driverStats[r.driver]) {
                    driverStats[r.driver] = { delivered: 0, returned: 0 };
                }
                driverStats[r.driver].returned += r.boxes;
            });
            
            // Ù…Ø³Ø­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¨Ù‚
            driverStatsDiv.innerHTML = '';
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø­Ø³Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø¯Ø±
            const sortedDrivers = Object.keys(driverStats).sort((a, b) => {
                const lossA = driverStats[a].delivered > 0 ? 
                    ((driverStats[a].delivered - driverStats[a].returned) / driverStats[a].delivered) * 100 : 0;
                const lossB = driverStats[b].delivered > 0 ? 
                    ((driverStats[b].delivered - driverStats[b].returned) / driverStats[b].delivered) * 100 : 0;
                return lossB - lossA;
            });
            
            sortedDrivers.forEach((driverName, index) => {
                const stats = driverStats[driverName];
                const lost = stats.delivered - stats.returned;
                const lossRate = stats.delivered > 0 ? ((lost / stats.delivered) * 100).toFixed(1) : 0;
                const cost = lost * CONFIG.boxCost;
                
                const driverDiv = document.createElement('div');
                driverDiv.className = 'driver-stats';
                
                // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø¯Ø±
                let lossClass = 'loss-low';
                if (parseFloat(lossRate) >= 20) lossClass = 'loss-high';
                else if (parseFloat(lossRate) >= 10) lossClass = 'loss-medium';
                
                driverDiv.innerHTML = `
                    <div class="driver-name">
                        ${index + 1}. ${driverName}
                        ${parseFloat(lossRate) >= 20 ? ' ğŸš¨' : parseFloat(lossRate) >= 10 ? ' âš ï¸' : ' âœ…'}
                    </div>
                    <div class="stat-row">
                        <span>${currentLanguage === 'ar' ? 'Ù…ÙØ³Ù„Ù…:' : 'Delivered:'}</span>
                        <span>${stats.delivered.toLocaleString()}</span>
                    </div>
                    <div class="stat-row">
                        <span>${currentLanguage === 'ar' ? 'Ù…ÙØ³ØªÙ„Ù…:' : 'Returned:'}</span>
                        <span>${stats.returned.toLocaleString()}</span>
                    </div>
                    <div class="stat-row">
                        <span>${currentLanguage === 'ar' ? 'Ù…ÙÙ‚ÙˆØ¯:' : 'Lost:'}</span>
                        <span>${lost.toLocaleString()}</span>
                    </div>
                    <div class="stat-row">
                        <span>${currentLanguage === 'ar' ? 'Ù†Ø³Ø¨Ø© Ø§Ù„Ù‡Ø¯Ø±:' : 'Loss Rate:'}</span>
                        <span class="loss-percentage ${lossClass}">${lossRate}%</span>
                    </div>
                    <div class="stat-row">
                        <span>${currentLanguage === 'ar' ? 'Ø§Ù„ØªÙƒÙ„ÙØ©:' : 'Cost:'}</span>
                        <span>${cost.toLocaleString()} ${currentLanguage === 'ar' ? 'Ø¯Ø±Ù‡Ù…' : 'AED'}</span>
                    </div>
                `;
                
                driverStatsDiv.appendChild(driverDiv);
            });
        }
        
        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function exportData() {
            const data = {
                deliveries: JSON.parse(localStorage.getItem('deliveries') || '[]'),
                returns: JSON.parse(localStorage.getItem('returns') || '[]'),
                exportDate: new Date().toISOString(),
                version: '2.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `box-tracking-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function clearAllData() {
            const confirmText = currentLanguage === 'ar' ? 
                'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.' :
                'Are you sure you want to clear all data? This action cannot be undone.';
                
            if (confirm(confirmText)) {
                localStorage.removeItem('deliveries');
                localStorage.removeItem('returns');
                localStorage.removeItem('lastUpdate');
                updateReports();
                
                const successText = currentLanguage === 'ar' ? 
                    'ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­' : 
                    'All data cleared successfully';
                alert(successText);
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬ ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        document.getElementById('userType').addEventListener('change', function() {
            const passwordGroup = document.getElementById('passwordGroup');
            const driverSelectGroup = document.getElementById('driverSelectGroup');
            
            if (this.value === 'manager') {
                passwordGroup.classList.remove('hidden');
                driverSelectGroup.classList.add('hidden');
            } else {
                passwordGroup.classList.add('hidden');
                driverSelectGroup.classList.remove('hidden');
            }
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function updateSettings() {
            const whatsappGroup = document.getElementById('whatsappGroup').value;
            const alertThreshold = document.getElementById('alertThreshold').value;
            
            localStorage.setItem('whatsappGroup', whatsappGroup);
            localStorage.setItem('alertThreshold', alertThreshold);
            
            CONFIG.whatsappGroup = whatsappGroup;
            CONFIG.alertThreshold = parseInt(alertThreshold);
        }
        
        // Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        document.addEventListener('change', function(e) {
            if (e.target.id === 'whatsappGroup' || e.target.id === 'alertThreshold') {
                updateSettings();
            }
        });
    </script>
</body>
</html>
